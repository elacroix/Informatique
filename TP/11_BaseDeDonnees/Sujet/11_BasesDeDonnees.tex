\documentclass[10pt]{article}
\input{style/coursHeadings}
\input{style/programHeadings}
\input{style/macros_SII}
\input{style/macros_Titres}
\input{style/macros_Frames}

%Si le boolen xp est vrai : compilation pour xabi
%Sinon compilation Damien
\newboolean{xp}
\setboolean{xp}{true}

\newboolean{prof}
\setboolean{prof}{true}

\usepackage[%
    pdftitle={Base de données},
    pdfauthor={Xavier Pessoles},
    colorlinks=true,
    linkcolor=blue,
    citecolor=magenta]{hyperref}

\def\discipline{Informatique}
\def\xxtitre{\ifthenelse{\boolean{xp}}{
CI 4 : Bases de données}{
Chapitre  -- }}

\def\xxsoustitre{\ifthenelse{\boolean{xp}}{
TP Base de données des aéroports du monde}{
Partie  -- }}

\def\xxauteur{\ifthenelse{\boolean{xp}}{
Xavier \textsc{Pessoles}}{
Damien \textsc{Iceta} \\ Xavier \textsc{Pessoles}}}

\def\xxpied{\ifthenelse{\boolean{xp}}{
CI 4 : Bases de données \\
Ch. 1 : Introduction aux bases de données -- TP}{
\xxtitre}}

\def\xxcathegorie{\ifthenelse{\boolean{xp}}{
2013 -- 2014 \\
Xavier \textsc{Pessoles}}{
Informatique - Cours}}



%---------------------------------------------------------------------------


\begin{document}

\ifthenelse{\boolean{xp}}{\input{style/enteteXP}}{\input{style/enteteDI}}




\section*{Présentation}
Le site internet \url{http://ourairports.com/} recueille des informations sur les aéroports du monde. Ces informations sont disponibles sous la forme d'une base de donnée SQLite. 
L'utilitaire SQLite Database Browser permet de visualiser le contenu d'une base de données au format SQLite. Pour consulter la base :

\begin{itemize}%[$\rightarrow$]
\item ouvrir l'utilitaire SQLite Database Browser;
\item ouvrir le fichier \textsf{Aeroports.sql3}.
\end{itemize}

En l'état, la base de données est constituée de 4 relations (appelées aussi tables): 
\begin{itemize}
\item \textsf{Airport\_Frequencies} recense les fréquences radio sur lesquelles les aéroports émettent;
\item \textsf{Countries} recense la liste des pays;
\item \textsf{Airports} recense la liste des aéroports;
\item \textsf{Regions} recense une liste des régions.
\end{itemize}



La relation \textsf{Airports} est constituée des attributs suivants : 
\begin{itemize}
\item \textsf{id} : un identifiant
\item \textsf{type} : un type (heliport, small\_airport, seaplane\_base ...)
\item \textsf{name} : un nom
\item des coordonnées géographiques(\textsf{latitude\_deg}, \textsf{latitude\_deg}, \textsf{elevation\_ft}, à savoir les latitudes et longitudes en degrés ainsi que l'altitude en pieds);
\item ...
\end{itemize}

\subsection*{Analyse de la base de données}
\subparagraph{}
\textit{Lors de la création de la base de données, le concepteur n'a pas pris garde au type de champ. Proposer un type de champ pour les attributs \textsf{latitude\_deg} et \textsf{municipality}. Dans la mesure du possible, modifier ces champs en éditant la table correspondante. Quel type de champ proposer pour l'attribut \textsf{id} ? D'après vous quelle précaution est-il nécessaire de prendre pour ce champ ?}

\subparagraph{}
\textit{Quels sont les attributs des relations \textsf{Countries}, \textsf{Regions} et \textsf{Airport\_Frequencies} ?}

Dans le but d'optimiser la base de données (à savoir diminuer le temps d'accès aux données, diminuer l'espace mémoire utilisé et éviter la redondance d'informations) on souhaite disposer de la relation \textsf{Airport\_Type}. Cette relation aura pour attribut un identifiant, un attribut de type texte correspondant au type d'aéroport en anglais, un attribut de type texte correspondant au type d'aéroport en français. 

\subparagraph{}
\textit{Créer la relation précédente dans la base de données. Quelles seraient les modifications à réaliser sur les données pour prendre en compte cette nouvelle relation ?}

\subsection*{Consultation de la base de données}

Il est possible d'interroger la base de données en utilisant Python. Pour cela, on utilise le formalisme suivant :

\begin{py}
\begin{python}
import sqlite3 # Import des commandes permettant de manipuler la base de données
basesql = u"airports.db3" # Base de données initiale

cnx = sqlite3.connect(basesql)
curseur = cnx.cursor()

requete = "SELECT * FROM airports"
curseur.execute(requete)
\end{python}

Le préfixe u permet d'importer les fichiers encodés en UTF-8. Dans un certaine mesure, les caractères spéciaux sont alors pris en compte.\end{py}


\begin{py}
Le curseur est un objet contenant le résultat de la requête. Pour visualiser la première entité de la requête, la syntaxe est la suivante : 
\begin{python}
data = curseur.fetchone()
print(data)
\end{python}

Attention, à chaque utilisation de \textsl{fetchone()}, l'entité est supprimée du curseur. Pour parcourir chacune des entités, on peut utiliser la syntaxe suivante : 
\begin{python}
for cur in curseur:
    print(cur)
\end{python}

Attention, cette opération peut s'avérer maladroite si la requête a un grand nombre d'entités. 
\end{py}

\subparagraph{}
\textit{Que permettent les lignes de code suivantes :}

\begin{py}
\begin{python}
requete = "SELECT * FROM airports"
curseur.execute(requete)
res = []
for cur in curseur:
    res.append(cur)
print(len(res))
\end{python}
\end{py}

\subparagraph{}
\textit{Réaliser une sélection des bases d'hydravions (\textsf{seaplane\_base}) dans le monde ? Vous préciserez la requête SQL nécessaire ainsi que sa traduction dans l'algèbre relationnelle. }


\subparagraph{}
\textit{En utilisant les possibilités de Python, donner le nombre de bases d'hydravion existantes. En utilisant la documentation, quelle requête SQL permet de donner le résultat équivalent ?}

\subparagraph{}
\textit{Donner la liste des villes françaises (\textsl{iso\_country='FR'}) hébergeant de telles bases. Vous donnerez la requête SQL ainsi que son expression en algèbre relationnelle.}


\subparagraph{}
\textit{Donner la liste des villes européennes (\textsl{continent='EU'}) hébergeant de telles bases ainsi que leur nom. Vous donnerez la requête SQL ainsi que son expression en algèbre relationnelle. Est-on sûr d'avoir tous les éléments de la liste ?}


\subparagraph{}
\textit{Donner la liste des villes européennes (\textsl{continent='EU'}) hébergeant de telles bases ainsi que leur nom et leur pays. Vous donnerez la requête SQL ainsi que son expression en algèbre relationnelle. Est-on sûr d'avoir tous les éléments de la liste ?}


\subsection*{Affichage des bases d'hydravion sur une carte}
On souhaite afficher toutes les bases d'hydravion européennes sur une carte GoogleEarth. 


\subparagraph{}
\textit{A partir des résultats d'une requête, mettre dans un tableau les lignes constituées du nom de l'aéroport, de sa longitude, de sa latitude et de son type. Une ligne constituera une seule chaîne de caractère, chaque champ étant séparé par une virgule. La fin de la ligne sera terminée par un $\backslash$n. De plus, les chaînes de caractères ne devront pas contenir le caractère \&.}

\begin{exemple}
Exemple de ligne : 
\begin{python}
'Blinn Lake Seaplane Base,-162.753005981445,55.2515983581543,seaplane_base\n'
\end{python}
\end{exemple}

\end{document}


